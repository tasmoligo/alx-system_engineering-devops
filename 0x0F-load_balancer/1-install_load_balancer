#!/usr/bin/env bash
# Installs and configures HAproxy on load balancer.
sudo apt-get install software-properties-common
sudo add-apt-repository ppa:vbernat/haproxy-2.7
sudo apt update
sudo apt install haproxy
FRONT="\nfrontend myfrontend\n\tbind *:80\n\tdefault_backend myservers\n"
BACK="\nbackend myservers\n\tbalance roundrobin\n\tserver 168185-web-01 100.25.153.68:80 check\n\tserver 168185-web-02 100.26.212.224:80 check\n"
sudo cp /etc/haproxy/haproxy.cfg /etc/haproxy/haproxy_default
echo -e "$FRONT" >> /etc/haproxy/haproxy.cfg
echo -e "$BACK" >> /etc/haproxy/haproxy.cfg
sudo service haproxy start
